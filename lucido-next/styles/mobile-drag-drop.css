/*
 * Estilos CSS utilitários para drag-and-drop mobile otimizado
 * Compatível com iOS Safari e Android Chrome
 */

/* ===== CLASSES BÁSICAS PARA DRAG ===== */

/* Elementos que podem ser arrastados */
.drag-handle {
  /* Previne qualquer tipo de scroll/pan durante o drag */
  touch-action: none;
  /* Otimiza rendering durante movimento */
  will-change: transform;
  /* Melhora área de toque (mínimo 48x48px) */
  min-height: 48px;
  min-width: 48px;
  /* Remove seleção de texto */
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  /* Melhora responsividade touch */
  -webkit-tap-highlight-color: transparent;
}

/* Contêineres com scroll que devem preservar pan vertical */
.drag-container-vertical {
  touch-action: pan-y pinch-zoom;
  overscroll-behavior: contain;
}

/* Contêineres com scroll que devem preservar pan horizontal */
.drag-container-horizontal {
  touch-action: pan-x pinch-zoom;
  overscroll-behavior: contain;
}

/* Elemento sendo preparado para drag (após pointer down) */
.drag-active {
  cursor: grabbing;
  /* Otimizações de performance */
  will-change: transform;
  /* Remove transições durante prep */
  transition: none !important;
}

/* Elemento sendo efetivamente arrastado */
.drag-dragging {
  /* Visual feedback */
  opacity: 0.85;
  transform: rotate(1deg);
  /* Remove pointer events para não interferir com drop detection */
  pointer-events: none;
  /* Z-index alto para ficar por cima */
  z-index: 1000;
  /* Sombra mais proeminente */
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.24);
}

/* ===== TARGETS DE DROP ===== */

/* Target básico para drop */
.drop-target {
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  /* Área mínima para touch preciso */
  min-height: 48px;
  min-width: 48px;
}

/* Target quando item está sendo arrastado por cima */
.drop-target-hover {
  transform: scale(1.05);
  box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
  border: 3px dashed #3b82f6;
  background: rgba(59, 130, 246, 0.08);
}

/* Target ativo/pronto para receber drop */
.drop-target-active {
  border: 3px solid #10b981;
  background: rgba(16, 185, 129, 0.12);
  transform: scale(1.02);
}

/* ===== ANIMAÇÕES E FEEDBACK ===== */

/* Animação de tremor para feedback de erro */
@keyframes shake-error {
  0%, 100% { transform: translateX(0) rotate(0); }
  10%, 30%, 50%, 70%, 90% {
    transform: translateX(-8px) rotate(-2deg);
  }
  20%, 40%, 60%, 80% {
    transform: translateX(8px) rotate(2deg);
  }
}

.animate-error-shake {
  animation: shake-error 0.6s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
}

/* Animação de sucesso */
@keyframes success-bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0) scale(1);
  }
  40% {
    transform: translateY(-8px) scale(1.05);
  }
  60% {
    transform: translateY(-4px) scale(1.02);
  }
}

.animate-success-bounce {
  animation: success-bounce 0.8s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
}

/* Ripple effect para touch feedback */
.touch-ripple {
  position: relative;
  overflow: hidden;
}

.touch-ripple::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  background: rgba(255, 255, 255, 0.4);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1),
              height 0.3s cubic-bezier(0.4, 0, 0.2, 1),
              opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  pointer-events: none;
  z-index: 1;
}

.touch-ripple:active::after {
  width: 48px;
  height: 48px;
  opacity: 0.7;
}

/* ===== OTIMIZAÇÕES MÓVEIS ===== */

/* Configurações específicas para telas touch */
@media (hover: none) and (pointer: coarse) {
  /* Aumenta áreas de toque */
  .drag-handle {
    min-height: 52px;
    min-width: 52px;
    /* Padding para hit-slop */
    padding: 8px;
  }

  /* Remove hover effects que não fazem sentido em touch */
  .drag-handle:hover {
    transform: none;
  }

  /* Melhora precisão do drop */
  .drop-target {
    min-height: 56px;
    min-width: 56px;
  }
}

/* Configurações para high-DPI screens */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .drag-dragging {
    /* Sombra mais suave em retina */
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
  }
}

/* ===== ESTADOS ESPECIAIS ===== */

/* Drag cancelado */
.drag-cancelled {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform: scale(0.95);
  opacity: 0.6;
}

/* Auto-scroll indicators */
.auto-scroll-top,
.auto-scroll-bottom {
  position: fixed;
  left: 0;
  right: 0;
  height: 40px;
  background: linear-gradient(to bottom, rgba(0,0,0,0.1), transparent);
  pointer-events: none;
  z-index: 999;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.auto-scroll-top {
  top: 0;
  background: linear-gradient(to bottom, rgba(0,0,0,0.1), transparent);
}

.auto-scroll-bottom {
  bottom: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.1), transparent);
}

.auto-scroll-active .auto-scroll-top,
.auto-scroll-active .auto-scroll-bottom {
  opacity: 1;
}

/* ===== ACCESSIBILITY ===== */

/* Foco visível para navegação por teclado */
.drag-handle:focus-visible {
  outline: 3px solid #3b82f6;
  outline-offset: 2px;
  box-shadow: 0 0 0 6px rgba(59, 130, 246, 0.2);
}

/* Estados ARIA */
.drag-handle[aria-grabbed="true"] {
  box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.4);
}

.drop-target[aria-dropeffect="move"] {
  border: 2px dashed rgba(59, 130, 246, 0.6);
}

/* ===== FALLBACKS PARA BROWSERS SEM POINTER EVENTS ===== */

/* Fallback touch events (iOS Safari antigo) */
@supports not (pointer-events: none) {
  .drag-handle {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
}

/* ===== CLASSES UTILITÁRIAS TAILWIND-STYLE ===== */

.touch-none { touch-action: none; }
.touch-pan-x { touch-action: pan-x pinch-zoom; }
.touch-pan-y { touch-action: pan-y pinch-zoom; }
.touch-manipulation { touch-action: manipulation; }

.overscroll-contain { overscroll-behavior: contain; }
.overscroll-none { overscroll-behavior: none; }
.overscroll-auto { overscroll-behavior: auto; }

.will-change-transform { will-change: transform; }
.will-change-auto { will-change: auto; }